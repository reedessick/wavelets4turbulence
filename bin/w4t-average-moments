#!/usr/bin/env python3

"""a simple script to pick up moments from multiple snapshots and average them assuming their all drawn from a stationary process
"""
__author__ = "Reed Essick (reed.essick@gmail.com)"

#-------------------------------------------------

import os

import numpy as np
import h5py

import matplotlib
matplotlib.use("Agg")
from matplotlib import pyplot as plt
plt.rcParams['text.usetex'] = True

from argparse import ArgumentParser

#-------------------------------------------------

TICK_PARAMS = dict(
    left=True,
    right=True,
    top=True,
    bottom=True,
    direction='in',
    which='both',
)

SUBPLOTS_ADJUST = dict(
    left=0.12,
    right=0.95,
    bottom=0.10,
    top=0.92,
    hspace=0.03,
)

#-------------------------------------------------

parser = ArgumentParser()

#---

parser.add_argument('inpaths', type=str, nargs='+'
    help='path to an HDF files containing moments')

parser.add_argument('--outpath', type=str, required=True,
    help='the path into which the combined moments will be written')

#---

parser.add_argument('-v', '--verbose', default=False, action='store_true')
parser.add_argument('-V', '--Verbose', default=False, action='store_true')

#---

args = parser.parse_args()

os.makedirs(os.path.abspath(os.path.dirname(args.outpath)), exist_ok=True)

args.verbose |= args.Verbose

#-------------------------------------------------

raise NotImplementedError

if args.verbose:
    print('loading moments from: '+args.inpath)

data = dict()
with h5py.File(args.inpath, 'r') as obj:
    for field in obj.keys():
        if args.Verbose:
            print('    loading: '+field)
        data[field] = dict((key, obj[field][key][:]) for key in obj[field].keys())
